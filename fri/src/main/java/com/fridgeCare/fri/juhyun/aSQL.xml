<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="aSQL">
	<select id="getMemb" resultType="aVO" parameterType="String">
		SELECT
		    id, NVL(b, 0) bcnt, condate, joindate
		FROM
		    member m, 
		    (
		        SELECT
		            bmno, COUNT(*) b
		        FROM
		            board
		        GROUP BY
		            bmno
		    ) 
		    
		WHERE
		    mno = bmno(+)
		    AND id = #{id}
	</select>
	
	<delete id="deleteThumb">
		DELETE FROM
		    thumb
		WHERE
		    tmno = #{mno}
	</delete>
	
	<delete id="deleteReply">
		DELETE FROM
		    reply
		WHERE
		    remno = #{mno}
	</delete>
	
	<select id="getBnoList" resultType="aVO" parameterType="int">
		SELECT
		    bno 
		FROM 
		    board 
		WHERE 
		    bmno = #{mno}
	</select>
	
	
	
	<select id="getLoginInfo" resultType="aVO">
		SELECT
		    id, mail
		FROM
		    member m
		WHERE
		    (sysdate - condate) > 365
		    AND isshow = 'Y'
		    AND id NOT IN(SELECT id FROM delinfo)
	</select>
	
	<select id="getDelInfo" resultType="aVO">
		SELECT
		    id, mail
		FROM
		    delinfo 
		WHERE
		    (sysdate - deldate) >= 7
		    AND isshow = 'Y'
	</select>
	
	<select id="getIsshow" resultType="int" parameterType="String">
		SELECT
		    COUNT(*)
		FROM
		    delinfo
		WHERE
		    isshow = 'N'
		    AND id = #{id}
	</select>
	
	<select id="getSevenLogin" resultType="aVO">
		SELECT
		    id, mail
		FROM
		    delinfo d
		WHERE
		    id NOT IN(SELECT
		                m.id
		            FROM
		                member m
		            WHERE
		                (sysdate - condate) > 365)
	</select>
	
	<delete id="deleteDelInfo" parameterType="String">
		DELETE FROM
			delinfo
		WHERE
			id = #{id}
	</delete>
	
	<insert id="addDelInfo" parameterType="aVO">
		INSERT INTO 
		    delinfo(dno, id, mail)
		VALUES(
		    (SELECT NVL(MAX(dno)+ 1, 1001) FROM delinfo), #{id}, #{mail}
		)
	</insert>
	
	<update id="setIsshow" parameterType="String">
		UPDATE
		    delinfo
		SET
		    isshow = 'N'
		WHERE
		    id = #{id}
	</update>
	
	
	<delete id="deleteBoardPart">
		DELETE FROM
		    boardpart
		WHERE
		    bno = #{bno}
	</delete>
	
	<delete id="deleteUserLike">
		delete from
		    userlike
		where
		    lmno = #{mno}
	</delete>
	<delete id="deleteLikeBno">
		delete from
		    userlike
		where
		    lbno = #{bno}
	</delete>
	<delete id="deleteBoardReply">
		delete from
		    reply
		where
		    rebno = #{bno} 
	</delete>
	<delete id="deleteBoard">
		DELETE FROM
		    board
		WHERE
		    bmno = #{mno}
	</delete>
	<select id="getBoardThumb" resultType="aVO" parameterType="int">
		SELECT
		    tno
		FROM
		    thumb
		WHERE
		    tno = ANY( SELECT
		                tno
		            FROM
		                board
		            WHERE
		                bmno = #{mno})
	</select>
	<delete id="deleteBoardThumb">
		DELETE FROM
		    thumb
		WHERE
		    tno = #{tno}
	</delete>
	<delete id="deleteMemb">
		DELETE FROM
		    member
		WHERE
		    mno = #{mno}
	</delete>
</mapper>